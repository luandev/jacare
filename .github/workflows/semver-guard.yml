name: semver-guard

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check semver compliance
        uses: actions/github-script@v7
        with:
          script: |
            // Safely access pull_request from payload
            const pr = context.payload.pull_request;
            
            if (!pr) {
              core.setFailed('No pull_request found in context.payload');
              return;
            }
            
            // Get PR title and body
            const title = pr.title || '';
            const body = pr.body || '';
            
            // Semver pattern: matches versions like v1.0.0, 1.0.0, v1.0.0-alpha.1, etc.
            const semverPattern = /^v?\d+\.\d+\.\d+(-[\w\.]+)?/;
            
            // Check if title follows semver
            if (!semverPattern.test(title.trim())) {
              core.setFailed(`PR title "${title}" does not follow semantic versioning format (e.g., "v1.0.0" or "1.0.0")`);
              return;
            }
            
            console.log(`âœ“ PR title "${title}" follows semver format`);

